<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>2022 科学上网 Ubuntu & CFW 实现透明代理 | PrintLove</title><meta name=keywords content="app"><meta name=description content="这篇文章是我折腾 3 天的结果，在这方面也是初学者，如果有问题，可以一块讨论。
目标 我家里有个不用的笔记本，所以用它来实现透明代理。
💡 透明代理：只要连接上了家里的局域网，不管是 wifi 还是连接到路由器的宽带，都可以自动的实现科学上网，无需设置什么。
准备 第一点：准备一台安装了 Ubuntu 桌面的电脑，连接上你的路由器，设置有线网络为静态 ip，如下图：
图解：
192.168.31.1 是我的路由器地址。 192.168.31.193 是我设置的 Ubuntu 的静态 ip，这个随意。 第二点：路由器需要支持 DHCP，需要后面设置 DNS 和网关，现在暂时不需要。
安装 CFW CFW 软件全称 clash for windows，看到名字不要以为只能在 windows 上安装，支持 mac/linux/windows，现在开始下载。
第一步：前往下载，选在下图红框软件。
第二步：解压，并进入目录运行 ./cfw ，这就运行起来了，但不能退出终端，有点不好。
💡 不要在 root 下运行，会出现 —no-sandbox 的错误，找了好久也没找到解决办法，涉及 electron 和 chrome 相关的。
加入桌面 现在讲 CFW 这个软件加入 Ubuntu 的软件中心，打开终端，新建一个 clash.desktop 文件，写入下面信息。
[Desktop Entry] Name=clash for windows Icon=/home/miaogaolin/cfw/logo.png Exec=/home/miaogaolin/cfw/cfw Type=Application 重点解释：
Exec 代表刚才执行 ./cfw 命令的路径。 Icon 图提供给你。 编辑好后，将该文件移动到 ~/."><meta name=author content="Evan Miao"><link rel=canonical href=https://www.gby.ai/ubuntu-cfw/><link crossorigin=anonymous href=/assets/css/stylesheet.0f4d06feb7a00553d7b46603ca44aaca1dd036cd7082d6cecf39137242c0cb9e.css integrity="sha256-D00G/regBVPXtGYDykSqyh3QNs1wgtbOzzkTckLAy54=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.gby.ai/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.gby.ai/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.gby.ai/favicon-32x32.png><link rel=apple-touch-icon href=https://www.gby.ai/apple-touch-icon.png><link rel=mask-icon href=https://www.gby.ai/safari_pinned_tab.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/style.css media=print onload='this.media="all"'><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?4bddc7ae6f2203e19017f349bdcc79c2",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-VE0D4BXTS2"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VE0D4BXTS2",{anonymize_ip:!1})}</script><meta property="og:title" content="2022 科学上网 Ubuntu & CFW 实现透明代理"><meta property="og:description" content="这篇文章是我折腾 3 天的结果，在这方面也是初学者，如果有问题，可以一块讨论。
目标 我家里有个不用的笔记本，所以用它来实现透明代理。
💡 透明代理：只要连接上了家里的局域网，不管是 wifi 还是连接到路由器的宽带，都可以自动的实现科学上网，无需设置什么。
准备 第一点：准备一台安装了 Ubuntu 桌面的电脑，连接上你的路由器，设置有线网络为静态 ip，如下图：
图解：
192.168.31.1 是我的路由器地址。 192.168.31.193 是我设置的 Ubuntu 的静态 ip，这个随意。 第二点：路由器需要支持 DHCP，需要后面设置 DNS 和网关，现在暂时不需要。
安装 CFW CFW 软件全称 clash for windows，看到名字不要以为只能在 windows 上安装，支持 mac/linux/windows，现在开始下载。
第一步：前往下载，选在下图红框软件。
第二步：解压，并进入目录运行 ./cfw ，这就运行起来了，但不能退出终端，有点不好。
💡 不要在 root 下运行，会出现 —no-sandbox 的错误，找了好久也没找到解决办法，涉及 electron 和 chrome 相关的。
加入桌面 现在讲 CFW 这个软件加入 Ubuntu 的软件中心，打开终端，新建一个 clash.desktop 文件，写入下面信息。
[Desktop Entry] Name=clash for windows Icon=/home/miaogaolin/cfw/logo.png Exec=/home/miaogaolin/cfw/cfw Type=Application 重点解释：
Exec 代表刚才执行 ./cfw 命令的路径。 Icon 图提供给你。 编辑好后，将该文件移动到 ~/."><meta property="og:type" content="article"><meta property="og:url" content="https://www.gby.ai/ubuntu-cfw/"><meta property="og:image" content="https://images.unsplash.com/photo-1584986152939-01133e0d31a2?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-27T15:25:26+08:00"><meta property="article:modified_time" content="2022-01-27T15:25:26+08:00"><meta property="og:site_name" content="PrintLove"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://images.unsplash.com/photo-1584986152939-01133e0d31a2?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"><meta name=twitter:title content="2022 科学上网 Ubuntu & CFW 实现透明代理"><meta name=twitter:description content="这篇文章是我折腾 3 天的结果，在这方面也是初学者，如果有问题，可以一块讨论。
目标 我家里有个不用的笔记本，所以用它来实现透明代理。
💡 透明代理：只要连接上了家里的局域网，不管是 wifi 还是连接到路由器的宽带，都可以自动的实现科学上网，无需设置什么。
准备 第一点：准备一台安装了 Ubuntu 桌面的电脑，连接上你的路由器，设置有线网络为静态 ip，如下图：
图解：
192.168.31.1 是我的路由器地址。 192.168.31.193 是我设置的 Ubuntu 的静态 ip，这个随意。 第二点：路由器需要支持 DHCP，需要后面设置 DNS 和网关，现在暂时不需要。
安装 CFW CFW 软件全称 clash for windows，看到名字不要以为只能在 windows 上安装，支持 mac/linux/windows，现在开始下载。
第一步：前往下载，选在下图红框软件。
第二步：解压，并进入目录运行 ./cfw ，这就运行起来了，但不能退出终端，有点不好。
💡 不要在 root 下运行，会出现 —no-sandbox 的错误，找了好久也没找到解决办法，涉及 electron 和 chrome 相关的。
加入桌面 现在讲 CFW 这个软件加入 Ubuntu 的软件中心，打开终端，新建一个 clash.desktop 文件，写入下面信息。
[Desktop Entry] Name=clash for windows Icon=/home/miaogaolin/cfw/logo.png Exec=/home/miaogaolin/cfw/cfw Type=Application 重点解释：
Exec 代表刚才执行 ./cfw 命令的路径。 Icon 图提供给你。 编辑好后，将该文件移动到 ~/."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.gby.ai/posts/"},{"@type":"ListItem","position":2,"name":"2022 科学上网 Ubuntu \u0026 CFW 实现透明代理","item":"https://www.gby.ai/ubuntu-cfw/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"2022 科学上网 Ubuntu \u0026 CFW 实现透明代理","name":"2022 科学上网 Ubuntu \u0026 CFW 实现透明代理","description":"这篇文章是我折腾 3 天的结果，在这方面也是初学者，如果有问题，可以一块讨论。\n目标 我家里有个不用的笔记本，所以用它来实现透明代理。\n💡 透明代理：只要连接上了家里的局域网，不管是 wifi 还是连接到路由器的宽带，都可以自动的实现科学上网，无需设置什么。\n准备 第一点：准备一台安装了 Ubuntu 桌面的电脑，连接上你的路由器，设置有线网络为静态 ip，如下图：\n图解：\n192.168.31.1 是我的路由器地址。 192.168.31.193 是我设置的 Ubuntu 的静态 ip，这个随意。 第二点：路由器需要支持 DHCP，需要后面设置 DNS 和网关，现在暂时不需要。\n安装 CFW CFW 软件全称 clash for windows，看到名字不要以为只能在 windows 上安装，支持 mac/linux/windows，现在开始下载。\n第一步：前往下载，选在下图红框软件。\n第二步：解压，并进入目录运行 ./cfw ，这就运行起来了，但不能退出终端，有点不好。\n💡 不要在 root 下运行，会出现 —no-sandbox 的错误，找了好久也没找到解决办法，涉及 electron 和 chrome 相关的。\n加入桌面 现在讲 CFW 这个软件加入 Ubuntu 的软件中心，打开终端，新建一个 clash.desktop 文件，写入下面信息。\n[Desktop Entry] Name=clash for windows Icon=/home/miaogaolin/cfw/logo.png Exec=/home/miaogaolin/cfw/cfw Type=Application 重点解释：\nExec 代表刚才执行 ./cfw 命令的路径。 Icon 图提供给你。 编辑好后，将该文件移动到 ~/.","keywords":["app"],"articleBody":"这篇文章是我折腾 3 天的结果，在这方面也是初学者，如果有问题，可以一块讨论。\n目标 我家里有个不用的笔记本，所以用它来实现透明代理。\n💡 透明代理：只要连接上了家里的局域网，不管是 wifi 还是连接到路由器的宽带，都可以自动的实现科学上网，无需设置什么。\n准备 第一点：准备一台安装了 Ubuntu 桌面的电脑，连接上你的路由器，设置有线网络为静态 ip，如下图：\n图解：\n192.168.31.1 是我的路由器地址。 192.168.31.193 是我设置的 Ubuntu 的静态 ip，这个随意。 第二点：路由器需要支持 DHCP，需要后面设置 DNS 和网关，现在暂时不需要。\n安装 CFW CFW 软件全称 clash for windows，看到名字不要以为只能在 windows 上安装，支持 mac/linux/windows，现在开始下载。\n第一步：前往下载，选在下图红框软件。\n第二步：解压，并进入目录运行 ./cfw ，这就运行起来了，但不能退出终端，有点不好。\n💡 不要在 root 下运行，会出现 —no-sandbox 的错误，找了好久也没找到解决办法，涉及 electron 和 chrome 相关的。\n加入桌面 现在讲 CFW 这个软件加入 Ubuntu 的软件中心，打开终端，新建一个 clash.desktop 文件，写入下面信息。\n[Desktop Entry] Name=clash for windows Icon=/home/miaogaolin/cfw/logo.png Exec=/home/miaogaolin/cfw/cfw Type=Application 重点解释：\nExec 代表刚才执行 ./cfw 命令的路径。 Icon 图提供给你。 编辑好后，将该文件移动到 ~/.local/share/applications ，完成！\n代理上网 第一步：导入 Profiles，粘贴 clash 订阅地址，点击 download，如果前面是绿色条代表选中。\n第二步：下来进入 General，打开如下选项，剩下的先不要管。\n图解：\nAllow LAN：局域网共享。 Mixin：在不动原有配置情况下，增加新的配置覆盖原有配置，覆盖位置 Settings\u003e Profile Mixin ，现在不用操作。 Start with LInux：开机自启动吧，这个我也不确定，没有测试。 完成了上述步骤后，就可以进行代理上网，只需要在浏览器或者手机配置代理即可，配置信息如下：\nip: Ubuntu 系统ip 端口：7890 💡 如果不可以，可能是防火墙的问题导致端口不能访问，解决办法：Ubuntu 开发所有端口\nTUN 1. 开启 但这个还不算透明，还需要配置代理，现在需要开启 TUN 功能，它可以劫持代理不能做到的请求，例如：ip 直接访问。\n第一步：安装 nftables 和 iproute2。\nsudo apt-get install -y nftables iproute2 第二步：点击上图 Service Mode 后的 Manage，再点击 install，我这个是已经安装好了，所以显示 Active。等一会，就把这个软件关闭重启，因为我测试时，Mac 下可以自动重启，但 Ubuntu 不行。\n第三步：重启后，就可以再次打开 Manage，看是否出现 Active，或者看 Service Mode 后的是否绿色地球图标。\n第四步：开启 TUN Mode，在 Connections 界面看看是否有 TUN 关键字，如果没有就等一会，因为担心没有请求。如果还不行，继续往下看解决办法。\n2. 解决问题 解决 TUN 不生效问题，先看 TUN 虚拟网卡是否创建，运行 ifconfig 命令，出现如下图：\n或者运行 route 命令。\n为啥会有两个呢，我也没搞懂，有就对了。倘若上图你没有出现，那我也不知道，你再查查，主要是我没有遇到过。\n重点下来说说，满足上面的，但 TUN 还是没有生效。\n下来的解决办法也是猜测，但却是也成功了，我估计是 root 权限的问题。开始解决，先进入 CFW 目录。\ncd resources/static/files/linux/common/service-installer 该目录下会出现一个 install.sh，打开后如下截图的命令没有执行成功。\n先查看 install、nft、ip 命令是否存在。\n$ which install ip nft /usr/bin/install /usr/sbin/ip /usr/sbin/nft nft 对应的 nftables 的安装，其它的默认应该就存在，如果不存在你自己再查查。\n下来运行分别运行如下命令：\nsudo install -m 0644 scripts/clash-default /etc/default/clash sudo install -m 0755 scripts/bypass-proxy-pid /usr/bin/bypass-proxy-pid sudo install -m 0755 scripts/bypass-proxy /usr/bin/bypass-proxy sudo install -m 0700 scripts/clean-tun.sh /usr/lib/clash/clean-tun.sh sudo install -m 0700 scripts/setup-tun.sh /usr/lib/clash/setup-tun.sh sudo install -m 0700 scripts/setup-cgroup.sh /usr/lib/clash/setup-cgroup.sh sudo install -m 0644 scripts/99-clash.rules /usr/lib/udev/rules.d/99-clash.rules 运行完之后再重启 CFW 再在 Connections 界面看看是否有 tun 关键字，如果没有可以在 General 界面把 TUN Mode 开关关闭再开启。\n这一顿折腾希望你可以整好。\n测试路由 在手机上手动设置路由（网关）和 DNS，都设置为 Ubuntu 系统的 IP 地址，下来测试是否可以科学上网。\n如果这一步失败了，可能是 DNS 问题，可以看看这篇文章 下载安装。\nDHCP 我的是小米路由器，下来的配置你在自己的路由器上找找。\n图中的 ip 地址就是 Ubuntu 系统的 ip。\n设置好后，保存等待路由器重启，重启完成好把刚刚设置的路由和 DNS 删除，就正常连接路由器就行 。\n到这了，不知道你的好没好，反正我的好了，不过有啥问题可以联系我，关于我 。\n总结 每个人的环境都会有差异，也会遇到各种各样的问题，所以需要极度的耐心才可以，毕竟很多人都是小白。\n现在也是刚开始，如果后期我有遇到新的问题，再来说说。\n如果想远程连接 Ubuntu 可以看看。\nUbuntu 安装 ssh 服务 向日葵远程连接 Ubuntu 桌面 参考 TUN 模式 | Clash for Windows DNS污染对Clash（for Windows）的影响 · Fndroid/clash_for_windows_pkg Wiki 在 Ubuntu18.04 上使用 clash 部署旁路代理网关（透明代理） | Breakertt Blog clash配置自定义规则 - Tomorrow's blog clash for windows允许局域网连接，TAP和TUN模式 - 旁逸斜出 Clash \u0026 Linux 实现透明代理 | 旁路网关，无需软路由/客户端让家里所有设备连接即实现科学上网 - YouTube 关于 clash 透明代理的一些问题 - V2EX 旁路由设置的三种方式 理解Linux虚拟网卡设备tun/tap的一切 | 骏马金龙 理解物理网卡、网卡接口、内核、IP等属性的关系 | 骏马金龙 udev - 维基百科，自由的百科全书 [Bug]: OpenSUSE 控制TUN模式的开关不工作 ","wordCount":"332","inLanguage":"zh","image":"https://images.unsplash.com/photo-1584986152939-01133e0d31a2?q=80\u0026w=1000\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D","datePublished":"2022-01-27T15:25:26+08:00","dateModified":"2022-01-27T15:25:26+08:00","author":[{"@type":"Person","name":"Evan Miao"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.gby.ai/ubuntu-cfw/"},"publisher":{"@type":"Organization","name":"PrintLove","logo":{"@type":"ImageObject","url":"https://www.gby.ai/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.gby.ai/ accesskey=h title="PrintLove (Alt + H)">PrintLove</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.gby.ai/archives title=文章><span>文章</span></a></li><li><a href=https://www.gby.ai/series title=系列><span>系列</span></a></li><li><a href=https://www.gby.ai/sponsor title=赞助><span>赞助</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>2022 科学上网 Ubuntu & CFW 实现透明代理</h1><div class=post-meta><span title='2022-01-27 15:25:26 +0800 CST'>2022-01-27</span>&nbsp;·&nbsp;Evan Miao&nbsp;|&nbsp;<a href=https://github.com/miaogaolin/workspace-obisidian-publisher/tree/main/content/posts/2022%20%e7%a7%91%e5%ad%a6%e4%b8%8a%e7%bd%91%20Ubuntu%20&%20CFW%20%e5%ae%9e%e7%8e%b0%e9%80%8f%e6%98%8e%e4%bb%a3%e7%90%86.md rel="noopener noreferrer" target=_blank>指出问题</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#目标>目标</a></li><li><a href=#准备>准备</a></li><li><a href=#安装-cfw>安装 CFW</a></li><li><a href=#加入桌面>加入桌面</a></li><li><a href=#代理上网>代理上网</a></li><li><a href=#tun>TUN</a><ul><li><a href=#1-开启>1. 开启</a></li><li><a href=#2-解决问题>2. 解决问题</a></li></ul></li><li><a href=#测试路由>测试路由</a></li><li><a href=#dhcp>DHCP</a></li><li><a href=#总结>总结</a></li><li><a href=#参考>参考</a></li></ul></nav></div></details></div><div class=post-content><p>这篇文章是我折腾 3 天的结果，在这方面也是初学者，如果有问题，可以一块讨论。</p><h2 id=目标>目标<a hidden class=anchor aria-hidden=true href=#目标>#</a></h2><p>我家里有个不用的笔记本，所以用它来实现透明代理。</p><p>💡 透明代理：只要连接上了家里的局域网，不管是 wifi 还是连接到路由器的宽带，都可以自动的实现科学上网，无需设置什么。</p><h2 id=准备>准备<a hidden class=anchor aria-hidden=true href=#准备>#</a></h2><p><strong>第一点</strong>：准备一台安装了 Ubuntu 桌面的电脑，连接上你的路由器，设置有线网络为静态 ip，如下图：<br><img loading=lazy src=/images/729743d253d2fd4ff46ebaf3a1eb210b.webp alt=729743d253d2fd4ff46ebaf3a1eb210b.webp><br><img loading=lazy src=/images/d263d98f67c5d04e19469b1ccbc313ce.webp alt=d263d98f67c5d04e19469b1ccbc313ce.webp></p><p>图解：</p><ul><li>192.168.31.1 是我的路由器地址。</li><li>192.168.31.193 是我设置的 Ubuntu 的静态 ip，这个随意。</li></ul><p><strong>第二点</strong>：路由器需要支持 DHCP，需要后面设置 DNS 和网关，现在暂时不需要。</p><h2 id=安装-cfw>安装 CFW<a hidden class=anchor aria-hidden=true href=#安装-cfw>#</a></h2><p>CFW 软件全称 clash for windows，看到名字不要以为只能在 windows 上安装，支持 mac/linux/windows，现在开始下载。</p><p><strong>第一步</strong>：<a href=https://github.com/Fndroid/clash_for_windows_pkg/releases>前往下载</a>，选在下图红框软件。</p><p><img loading=lazy src=/images/5074b6a8c4e39b73652038dc296f905e.webp alt=5074b6a8c4e39b73652038dc296f905e.webp></p><p><strong>第二步</strong>：解压，并进入目录运行 .<code>/cfw</code> ，这就运行起来了，但不能退出终端，有点不好。</p><p>💡 不要在 root 下运行，会出现 —no-sandbox 的错误，找了好久也没找到解决办法，涉及 electron 和 chrome 相关的。</p><h2 id=加入桌面>加入桌面<a hidden class=anchor aria-hidden=true href=#加入桌面>#</a></h2><p>现在讲 CFW 这个软件加入 Ubuntu 的软件中心，打开终端，新建一个 <strong>clash.desktop</strong> 文件，写入下面信息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>Desktop Entry<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>Name<span style=color:#f92672>=</span>clash <span style=color:#66d9ef>for</span> windows
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>Icon<span style=color:#f92672>=</span>/home/miaogaolin/cfw/logo.png
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>Exec<span style=color:#f92672>=</span>/home/miaogaolin/cfw/cfw
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>Type<span style=color:#f92672>=</span>Application
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p>重点解释：</p><ul><li>Exec 代表刚才执行 <code>./cfw</code> 命令的路径。</li><li>Icon 图提供给你。</li></ul><p><img loading=lazy src=/images/d23610fdc7ebf266cd6a31d51401479b.webp alt=d23610fdc7ebf266cd6a31d51401479b.webp></p><p>编辑好后，将该文件移动到 <code>~/.local/share/applications</code> ，完成！</p><h2 id=代理上网>代理上网<a hidden class=anchor aria-hidden=true href=#代理上网>#</a></h2><p><strong>第一步</strong>：导入 Profiles，粘贴 clash 订阅地址，点击 download，如果前面是绿色条代表选中。<br><img loading=lazy src=/images/937555ae82851d953bf7be80164c192a.webp alt="Profiles 界面"></p><p><strong>第二步</strong>：下来进入 General，打开如下选项，剩下的先不要管。<br><img loading=lazy src=/images/a0e988e845688df3664b658d31b5464a.webp alt="General 界面"></p><p>图解：</p><ul><li>Allow LAN：局域网共享。</li><li>Mixin：在不动原有配置情况下，增加新的配置覆盖原有配置，覆盖位置 <code>Settings> Profile Mixin</code> ，现在不用操作。</li><li>Start with LInux：开机自启动吧，这个我也不确定，没有测试。</li></ul><p>完成了上述步骤后，就可以进行代理上网，只需要在浏览器或者手机配置代理即可，配置信息如下：</p><ul><li>ip: Ubuntu 系统ip</li><li>端口：7890</li></ul><p>💡 如果不可以，可能是防火墙的问题导致端口不能访问，解决办法：<a href="https://www.notion.so/Ubuntu-83f510195e89420aa23d99f7871564f7?pvs=21">Ubuntu 开发所有端口</a></p><h2 id=tun>TUN<a hidden class=anchor aria-hidden=true href=#tun>#</a></h2><h3 id=1-开启>1. 开启<a hidden class=anchor aria-hidden=true href=#1-开启>#</a></h3><p>但这个还不算透明，还需要配置代理，现在需要开启 TUN 功能，它可以劫持代理不能做到的请求，例如：ip 直接访问。</p><p><strong>第一步</strong>：安装 nftables 和 iproute2。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get install -y nftables iproute2
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p><strong>第二步</strong>：点击上图 Service Mode 后的 Manage，再点击 install，我这个是已经安装好了，所以显示 Active。等一会，就把这个软件关闭重启，因为我测试时，Mac 下可以自动重启，但 Ubuntu 不行。<br><img loading=lazy src=/images/f5ee3e3b600a290529b34681428dd6ac.webp alt=f5ee3e3b600a290529b34681428dd6ac.webp></p><p><strong>第三步</strong>：重启后，就可以再次打开 Manage，看是否出现 Active，或者看 Service Mode 后的是否绿色地球图标。<br><img loading=lazy src=/images/2e00df3d80b9996a29b350c9e167160c.webp alt=2e00df3d80b9996a29b350c9e167160c.webp></p><p><strong>第四步</strong>：开启 TUN Mode，在 Connections 界面看看是否有 TUN 关键字，如果没有就等一会，因为担心没有请求。如果还不行，继续往下看解决办法。<br><img loading=lazy src=/images/b3e2d22e25e75085413e7227ce159331.webp alt=b3e2d22e25e75085413e7227ce159331.webp></p><h3 id=2-解决问题>2. 解决问题<a hidden class=anchor aria-hidden=true href=#2-解决问题>#</a></h3><p>解决 TUN 不生效问题，先看 TUN 虚拟网卡是否创建，运行 <code>ifconfig</code> 命令，出现如下图：<br><img loading=lazy src=/images/eeda0f20b31f86e2c04842a033da4ce0.webp alt=eeda0f20b31f86e2c04842a033da4ce0.webp></p><p>或者运行 <code>route</code> 命令。<br><img loading=lazy src=/images/3c3c9ef5460f0066ab738fb002a1f6c4.webp alt=3c3c9ef5460f0066ab738fb002a1f6c4.webp></p><p>为啥会有两个呢，我也没搞懂，有就对了。倘若上图你没有出现，那我也不知道，你再查查，主要是我没有遇到过。</p><p>重点下来说说，满足上面的，但 TUN 还是没有生效。</p><p>下来的解决办法也是猜测，但却是也成功了，我估计是 root 权限的问题。开始解决，先进入 CFW 目录。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd resources/static/files/linux/common/service-installer
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p>该目录下会出现一个 install.sh，打开后如下截图的命令没有执行成功。<br><img loading=lazy src=/images/9bb3eadb5e82dd4c3caeb162a493832a.webp alt=install.sh></p><p>先查看 install、nft、ip 命令是否存在。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ which install ip nft
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>/usr/bin/install
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>/usr/sbin/ip
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>/usr/sbin/nft
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p>nft 对应的 nftables 的安装，其它的默认应该就存在，如果不存在你自己再查查。</p><p>下来运行分别运行如下命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo install -m <span style=color:#ae81ff>0644</span> scripts/clash-default /etc/default/clash
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>sudo install -m <span style=color:#ae81ff>0755</span> scripts/bypass-proxy-pid /usr/bin/bypass-proxy-pid
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>sudo install -m <span style=color:#ae81ff>0755</span> scripts/bypass-proxy /usr/bin/bypass-proxy
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>sudo install -m <span style=color:#ae81ff>0700</span> scripts/clean-tun.sh /usr/lib/clash/clean-tun.sh
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>sudo install -m <span style=color:#ae81ff>0700</span> scripts/setup-tun.sh /usr/lib/clash/setup-tun.sh
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>sudo install -m <span style=color:#ae81ff>0700</span> scripts/setup-cgroup.sh /usr/lib/clash/setup-cgroup.sh
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>sudo install -m <span style=color:#ae81ff>0644</span> scripts/99-clash.rules /usr/lib/udev/rules.d/99-clash.rules
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p>运行完之后再重启 CFW 再在 Connections 界面看看是否有 tun 关键字，如果没有可以在 General 界面把 TUN Mode 开关关闭再开启。</p><p>这一顿折腾希望你可以整好。</p><h2 id=测试路由>测试路由<a hidden class=anchor aria-hidden=true href=#测试路由>#</a></h2><p>在手机上手动设置路由（网关）和 DNS，都设置为 Ubuntu 系统的 IP 地址，下来测试是否可以科学上网。</p><p>如果这一步失败了，可能是 DNS 问题，可以看看这篇文章 <a href=https://help.bprolink.com/linux/clash.html#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85>下载安装</a>。</p><h2 id=dhcp>DHCP<a hidden class=anchor aria-hidden=true href=#dhcp>#</a></h2><p>我的是小米路由器，下来的配置你在自己的路由器上找找。<br><img loading=lazy src=/images/d673747726714bdbc73944cb4fb03018.webp alt="DNS 和网关"></p><p>图中的 ip 地址就是 Ubuntu 系统的 ip。</p><p>设置好后，保存等待路由器重启，重启完成好把刚刚设置的路由和 DNS 删除，就正常连接路由器就行 。</p><p>到这了，不知道你的好没好，反正我的好了，不过有啥问题可以联系我，<a href="https://www.notion.so/9d3cf695ba0f44e787fb3f9e6aa9fd25?pvs=21">关于我</a> 。</p><h2 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h2><p>每个人的环境都会有差异，也会遇到各种各样的问题，所以需要极度的耐心才可以，毕竟很多人都是小白。</p><p>现在也是刚开始，如果后期我有遇到新的问题，再来说说。</p><p>如果想远程连接 Ubuntu 可以看看。</p><ul><li><a href="https://www.notion.so/Ubuntu-ssh-7125396394864f10a8edafebe7d0d14c?pvs=21">Ubuntu 安装 ssh 服务</a></li><li><a href="https://www.notion.so/Ubuntu-35799b8decc74ff49796784985d02876?pvs=21">向日葵远程连接 Ubuntu 桌面</a></li></ul><h2 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h2><ul><li><a href=https://docs.cfw.lbyczf.com/contents/tun.html#macos>TUN 模式 | Clash for Windows</a></li><li><a href=https://github.com/Fndroid/clash_for_windows_pkg/wiki/DNS%E6%B1%A1%E6%9F%93%E5%AF%B9Clash%EF%BC%88for-Windows%EF%BC%89%E7%9A%84%E5%BD%B1%E5%93%8D>DNS污染对Clash（for Windows）的影响 · Fndroid/clash_for_windows_pkg Wiki</a></li><li><a href=https://breakertt.moe/2019/08/20/clash_gateway/>在 Ubuntu18.04 上使用 clash 部署旁路代理网关（透明代理） | Breakertt Blog</a></li><li><a href=https://tomorrow505.xyz/clash%E9%85%8D%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%84%E5%88%99/>clash配置自定义规则 - Tomorrow's blog</a></li><li><a href=https://www.mihu.live/archives/208/>clash for windows允许局域网连接，TAP和TUN模式 - 旁逸斜出</a></li><li><a href="https://www.youtube.com/watch?v=r24-cmWV9RU">Clash & Linux 实现透明代理 | 旁路网关，无需软路由/客户端让家里所有设备连接即实现科学上网 - YouTube</a></li><li><a href=https://www.v2ex.com/t/691924>关于 clash 透明代理的一些问题 - V2EX</a></li><li><a href=https://oeone.cn/archives/486.html>旁路由设置的三种方式</a></li><li><a href=https://www.junmajinlong.com/virtual/network/all_about_tun_tap/>理解Linux虚拟网卡设备tun/tap的一切 | 骏马金龙</a></li><li><a href=https://junmajinlong.com/virtual/network/kernel_nic_ip/>理解物理网卡、网卡接口、内核、IP等属性的关系 | 骏马金龙</a></li><li><a href=https://zh.wikipedia.org/wiki/Udev>udev - 维基百科，自由的百科全书</a></li><li><a href=https://github.com/Fndroid/clash_for_windows_pkg/issues/2597>[Bug]: OpenSUSE 控制TUN模式的开关不工作</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.gby.ai/tags/app/>app</a></li></ul><nav class=paginav><a class=prev href=https://www.gby.ai/tools-vercel/><span class=title>« 上一页</span><br><span>Golang在线工具迁入Vercel</span></a>
<a class=next href=https://www.gby.ai/vercel-cross/><span class=title>下一页 »</span><br><span>Vercel 解决静态网站接口跨域</span></a></nav><div class=comment-head>评论 & Email：</div><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 2022 科学上网 Ubuntu & CFW 实现透明代理 on x" href="https://x.com/intent/tweet/?text=@laomiao_ 2022%20%e7%a7%91%e5%ad%a6%e4%b8%8a%e7%bd%91%20Ubuntu%20%26%20CFW%20%e5%ae%9e%e7%8e%b0%e9%80%8f%e6%98%8e%e4%bb%a3%e7%90%86&amp;url=https%3a%2f%2fwww.gby.ai%2fubuntu-cfw%2f&amp;hashtags=app"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 50 50" fill="currentcolor"><path d="M5.9199219 6 20.582031 27.375 6.2304688 44H9.4101562L21.986328 29.421875 31.986328 44H44L28.681641 21.669922 42.199219 6H39.029297L27.275391 19.617188 17.933594 6H5.9199219zm3.796875 2H16.880859L40.203125 42H33.039062L9.7167969 8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 2022 科学上网 Ubuntu & CFW 实现透明代理 on email" href="mailto:mglluoye@gmail.com?subject=2022%20%e7%a7%91%e5%ad%a6%e4%b8%8a%e7%bd%91%20Ubuntu%20%26%20CFW%20%e5%ae%9e%e7%8e%b0%e9%80%8f%e6%98%8e%e4%bb%a3%e7%90%86"><svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 12C2 7.28595 2 4.92893 3.46447 3.46447 4.92893 2 7.28595 2 12 2c4.714.0 7.0711.0 8.5355 1.46447C22 4.92893 22 7.28595 22 12c0 4.714.0 7.0711-1.4645 8.5355C19.0711 22 16.714 22 12 22c-4.71405.0-7.07107.0-8.53553-1.4645C2 19.0711 2 16.714 2 12z" stroke="currentcolor" stroke-width="1.5"/><path d="M2 13H5.16026c.90517.0 1.35776.0 1.75558.183.39783.1829.69237.5266 1.28145 1.2138L8.80271 15.1032C9.39179 15.7904 9.68633 16.1341 10.0842 16.317 10.482 16.5 10.9346 16.5 11.8397 16.5H12.1603C13.0654 16.5 13.518 16.5 13.9158 16.317 14.3137 16.1341 14.6082 15.7904 15.1973 15.1032L15.8027 14.3968C16.3918 13.7096 16.6863 13.3659 17.0842 13.183 17.482 13 17.9346 13 18.8397 13H22" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/><path d="M8 7h8" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/><path d="M10 10.5h4" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/></svg></a></div></footer></article></main><footer class=footer><span>Content under license <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
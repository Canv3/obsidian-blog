<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>深入微服务：1. 开篇 gRPC 环境&启动 | PrintLove</title><meta name=keywords content="gRPC"><meta name=description content="gRPC 的环境搭建及入门使用"><meta name=author content="Evan Miao"><link rel=canonical href=https://www.gby.ai/grpc-start/><link crossorigin=anonymous href=/assets/css/stylesheet.0f4d06feb7a00553d7b46603ca44aaca1dd036cd7082d6cecf39137242c0cb9e.css integrity="sha256-D00G/regBVPXtGYDykSqyh3QNs1wgtbOzzkTckLAy54=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.gby.ai/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.gby.ai/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.gby.ai/favicon-32x32.png><link rel=apple-touch-icon href=https://www.gby.ai/apple-touch-icon.png><link rel=mask-icon href=https://www.gby.ai/safari_pinned_tab.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/style.css media=print onload='this.media="all"'><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?4bddc7ae6f2203e19017f349bdcc79c2",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-VE0D4BXTS2"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VE0D4BXTS2",{anonymize_ip:!1})}</script><meta property="og:title" content="深入微服务：1. 开篇 gRPC 环境&启动"><meta property="og:description" content="gRPC 的环境搭建及入门使用"><meta property="og:type" content="article"><meta property="og:url" content="https://www.gby.ai/grpc-start/"><meta property="og:image" content="https://images.unsplash.com/photo-1608231018855-dbd537cadcb5?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-08T16:48:56+08:00"><meta property="article:modified_time" content="2021-11-08T16:48:56+08:00"><meta property="og:site_name" content="PrintLove"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://images.unsplash.com/photo-1608231018855-dbd537cadcb5?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"><meta name=twitter:title content="深入微服务：1. 开篇 gRPC 环境&启动"><meta name=twitter:description content="gRPC 的环境搭建及入门使用"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.gby.ai/posts/"},{"@type":"ListItem","position":2,"name":"深入微服务：1. 开篇 gRPC 环境\u0026启动","item":"https://www.gby.ai/grpc-start/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"深入微服务：1. 开篇 gRPC 环境\u0026启动","name":"深入微服务：1. 开篇 gRPC 环境\u0026启动","description":"gRPC 的环境搭建及入门使用","keywords":["gRPC"],"articleBody":"从这篇开始，《深入微服务》系列就开始了，该系列从微服务的“应用”与“原理”两条线路进行推进，让咱大家伙明白微服务内部到底是个啥。好了不吹牛了，烂尾就打脸了。\n该篇代码：\nhttps://github.com/miaogaolin/gofirst/tree/main/example/helloworld\n学到什么 什么是 gRPC ? 什么是 Protobuf ? 如何搭建 gRPC 环境？ 如何应用 gRPC ? 什么是 gRPC gRPC 是基于 Http/2 协议的开源远程过程调用系统。\n远程过程调用，即 RPC (Remote Procedure Calls) ，它实现了像本地一样调用远程的方法，而不考虑底层的具体实现细节。\n而为了远程调用时数据传输的更高效，选择了 Protobuf，平常我们使用较多的就是 JSON、XML。\ngRPC 调用模型 一个完整的调用过程如下：\n假如客户端 (Client) 调用服务端 (Server) 上的 A 方法，则发起 RPC 调用。 对请求信息使用 Protobuf 进行对象序列化压缩。 服务端接收到请求后，解码请求体，进行业务逻辑处理并返回。 对响应结果使用 Protobuf 进行对象序列化压缩。 客户端接受到服务端响应，解码请求体，并唤醒正在等待 A 方法响应的客户端调用。 什么是 Protobuf Protobuf (Protocol buffers) 和 Go 都是一个亲妈，来自于 Google。它用于序列结构化数据，提供了一种相比 XML、JSON 格式，会更小、更快、操作更简单的方法。\n先简单对比下。\nJSON\n{ \"name\": \"laomiao\", \"id\": 1, \"email\": \"2825873215@qq.com\" } Protobuf\nmessage Person { string name = 1; int32 id = 2; string email = 3; } 该信息存储于后缀为 proto 的文件中，它只提供格式，而不存储数据。在使用时，用 Protobuf 编译工具将该文件编译成你所使用的语言。\n例如，在 Go 语言中，会根据该信息生成编译后的 Go 文件，message Person 会对应到 struct Person 上，并提供了序列化结构体的方法。\n本篇不会详细讲解 Protobuf 定义语法，只会把用到的进行简单描述，详细的前往：\nhttps://developers.google.com/protocol-buffers/docs/proto3\n编译工具 将 Proto 文件编译成 Go 代码需要两个工具：\nprotoc 工具，c++ 语言实现。 protoc-gen-go 插件，go 语言实现，给 protoc 工具提供插件，生成 go 代码。 gRPC 系统也要基于 Proto 文件生成相关代码，因此还需要一个工具：\nprotoc-gen-go-grpc 插件，go 语言实现，配合上面两个工具。 下来开始安装这些工具。\nprotoc 工具安装 1. 下载 地址：https://github.com/protocolbuffers/protobuf/releases。\n根据自己的系统选择对应的版本，我这块选择了 Win64。\n2. 环境变量 先解压，将整个目录放置到你想要的位置，再把 bin 目录加入环境变量，完成后在控制台输入命令。\n$ protoc --version libprotoc 3.15.8 成功搞定！\n插件安装 go install google.golang.org/protobuf/cmd/protoc-gen-go@v1.26 go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.1 安装完成后，会在 $GOPATH/bin 目录下生成两个文件，记得这个目录也要加入环境变量。\n编写 Proto 创建 \"helloword.proto\" 文件。\nsyntax = \"proto3\"; option go_package = \"github.com/miaogaolin/gofirst/example/helloworld\"; // The greeting service definition. service Greeter { // Sends a greeting rpc SayHello (HelloRequest) returns (HelloReply) {} } // The request message containing the user's name. message HelloRequest { string name = 1; } // The response message containing the greetings message HelloReply { string message = 1; } 解释如下：\n第一行，proto3 声明版本号为 3，不写时，默认版本为 2。 go_package 定义包路径。 Greeter 为 rpc 服务，远程调用的方法为 SayHello。 HelloRequest 用于 SayHello 方法参数。 HelloReply 用于 SayHello 方法返回。 name 和 message 后的数字 1 是给字段分配的唯一编号，如果新增加字段就给分配 2、3、4 等等。 生成代码 工具装好、proto 文件编写好，下来就开始使用工具生成代码。\nprotoc --go_out=. --go_opt=paths=source_relative \\ --go-grpc_out=. --go-grpc_opt=paths=source_relative \\ helloworld.proto go_out：生成 go 文件（不含 rpc 代码）的输出目录。 go_opt=paths=source_relative：生成的 go 文件和 proto 源文件在同一目录，如果 go_out 定义为其它目录，该设置无效。 go-grpc_out：rpc 的 go 文件输出目录。 go-grpc_opt=paths=source_relative：生成 rpc 的 go 文件和 proto 源文件在同一目录，如果 go-grpc_out 定义为其它目录，该设置无效。 运行后，会在当前目录下产生两个文件：\nhelloworld.pb.go：数据类型代码。 helloworld_grpc.pb.go：rpc 相关代码，其中会产生 GreeterClient 和 GreeterServer 两个接口，一会要实现。 远程调用 要实现 gRPC 的远程调用，就要分别实现 “客户端” 和 “服务端” 代码，下来我会给出关键性代码的说明，完整的前往 Github。\n1. 服务端 // example/hellworld/server/main.go // 实现服务端 GreeterServer 接口 type server struct { // 必须嵌套 // 包含了 GreeterServer 接口其它方法实现 pb.UnimplementedGreeterServer } // 远程调用方法的具体逻辑 func (s *server) SayHello(ctx context.Context, in *pb.HelloRequest) (*pb.HelloReply, error) { log.Printf(\"Received: %v\", in.GetName()) return \u0026pb.HelloReply{Message: \"Hello \" + in.GetName()}, nil } func main() { // 监听端口，用于接受客户端的请求 lis, err := net.Listen(\"tcp\", port) ... // 服务端实例化 s := grpc.NewServer() // 将具体的实现注册到服务端 pb.RegisterGreeterServer(s, \u0026server{}) // 阻塞等待 if err := s.Serve(lis); err != nil { log.Fatalf(\"failed to serve: %v\", err) } } 主线流程：\n监听端口； 实例化服务端； 将具体实现进行注册； 阻塞等待。 2. 客户端 实现好了服务端，下来客户端只需要远程调用就行。\n// example/hellworld/client/main.go func main() { // 连接服务端 // grpc.WithInsecure() 跳过安全验证，即明文传输 // grpc.WithBlock() 等待与服务端握手成功 conn, err := grpc.Dial(address, grpc.WithInsecure(), grpc.WithBlock()) ... // 客户端实例化 c := pb.NewGreeterClient(conn) ... // 连接超时设置 ctx, cancel := context.WithTimeout(context.Background(), time.Second) defer cancel() // 远程调用 r, err := c.SayHello(ctx, \u0026pb.HelloRequest{Name: name}) if err != nil { log.Fatalf(\"could not greet: %v\", err) } // 返回消息 log.Printf(\"Greeting: %s\", r.GetMessage()) } 主线流程：\n连接服务端； 实例化客户端； 开始调用； 获取返回消息。 3. 运行 先执行服务端代码，再执行客户端代码。\n服务端\n$ go run main.go 2021/11/04 11:28:19 server listening at [::]:50051 客户端\n$ go run main.go 2021/11/04 11:30:17 Greeting: Hello world 客户端接收到了服务端的响应，一切完成！\n参考 gPRC 官网：https://grpc.io/docs/languages/go/quickstart/ gRPC 应用：https://segmentfault.com/a/1190000019608421 gRPC 超时限制：https://www.cnblogs.com/jiujuan/p/13499915.html ","wordCount":"490","inLanguage":"zh","image":"https://images.unsplash.com/photo-1608231018855-dbd537cadcb5?q=80\u0026w=1000\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D","datePublished":"2021-11-08T16:48:56+08:00","dateModified":"2021-11-08T16:48:56+08:00","author":[{"@type":"Person","name":"Evan Miao"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.gby.ai/grpc-start/"},"publisher":{"@type":"Organization","name":"PrintLove","logo":{"@type":"ImageObject","url":"https://www.gby.ai/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.gby.ai/ accesskey=h title="PrintLove (Alt + H)">PrintLove</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.gby.ai/archives title=文章><span>文章</span></a></li><li><a href=https://www.gby.ai/series title=系列><span>系列</span></a></li><li><a href=https://www.gby.ai/sponsor title=赞助><span>赞助</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>深入微服务：1. 开篇 gRPC 环境&启动</h1><div class=post-meta><span title='2021-11-08 16:48:56 +0800 CST'>2021-11-08</span>&nbsp;·&nbsp;Evan Miao&nbsp;|&nbsp;<a href=https://github.com/miaogaolin/workspace-obisidian-publisher/tree/main/content/posts/%e6%b7%b1%e5%85%a5%e5%be%ae%e6%9c%8d%e5%8a%a1%ef%bc%9a1.%20%e5%bc%80%e7%af%87%20gRPC%20%e7%8e%af%e5%a2%83&%e5%90%af%e5%8a%a8.md rel="noopener noreferrer" target=_blank>指出问题</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#学到什么>学到什么</a></li><li><a href=#什么是-grpc>什么是 gRPC</a></li><li><a href=#grpc-调用模型>gRPC 调用模型</a></li><li><a href=#什么是-protobuf>什么是 Protobuf</a></li><li><a href=#编译工具>编译工具</a></li><li><a href=#protoc-工具安装>protoc 工具安装</a><ul><li><a href=#1-下载>1. 下载</a></li><li><a href=#2-环境变量>2. 环境变量</a></li></ul></li><li><a href=#插件安装>插件安装</a></li><li><a href=#编写-proto>编写 Proto</a></li><li><a href=#生成代码>生成代码</a></li><li><a href=#远程调用>远程调用</a><ul><li><a href=#1-服务端>1. 服务端</a></li><li><a href=#2-客户端>2. 客户端</a></li><li><a href=#3-运行>3. 运行</a></li></ul></li><li><a href=#参考>参考</a></li></ul></nav></div></details></div><div class=post-content><p>从这篇开始，《深入微服务》系列就开始了，该系列从微服务的“应用”与“原理”两条线路进行推进，让咱大家伙明白微服务内部到底是个啥。好了不吹牛了，烂尾就打脸了。</p><p>该篇代码：</p><p><a href=https://github.com/miaogaolin/gofirst/tree/main/example/helloworld>https://github.com/miaogaolin/gofirst/tree/main/example/helloworld</a></p><h2 id=学到什么>学到什么<a hidden class=anchor aria-hidden=true href=#学到什么>#</a></h2><ol><li>什么是 gRPC ?</li><li>什么是 Protobuf ?</li><li>如何搭建 gRPC 环境？</li><li>如何应用 gRPC ?</li></ol><h2 id=什么是-grpc>什么是 gRPC<a hidden class=anchor aria-hidden=true href=#什么是-grpc>#</a></h2><p>gRPC 是基于 Http/2 协议的开源远程过程调用系统。</p><p>远程过程调用，即 RPC (Remote Procedure Calls) ，它实现了像本地一样调用远程的方法，而不考虑底层的具体实现细节。</p><p>而为了远程调用时数据传输的更高效，选择了 Protobuf，平常我们使用较多的就是 JSON、XML。</p><h2 id=grpc-调用模型>gRPC 调用模型<a hidden class=anchor aria-hidden=true href=#grpc-调用模型>#</a></h2><p><img loading=lazy src=/images/20231208111284.webp alt=20231208111284.webp></p><p>一个完整的调用过程如下：</p><ol><li>假如客户端 (Client) 调用服务端 (Server) 上的 A 方法，则发起 RPC 调用。</li><li>对请求信息使用 Protobuf 进行对象序列化压缩。</li><li>服务端接收到请求后，解码请求体，进行业务逻辑处理并返回。</li><li>对响应结果使用 Protobuf 进行对象序列化压缩。</li><li>客户端接受到服务端响应，解码请求体，并唤醒正在等待 A 方法响应的客户端调用。</li></ol><h2 id=什么是-protobuf>什么是 Protobuf<a hidden class=anchor aria-hidden=true href=#什么是-protobuf>#</a></h2><p>Protobuf (Protocol buffers) 和 Go 都是一个亲妈，来自于 Google。它用于序列结构化数据，提供了一种相比 XML、JSON 格式，会更小、更快、操作更简单的方法。</p><p>先简单对比下。</p><p><strong>JSON</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JSON data-lang=JSON><span style=display:flex><span>{
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;laomiao&#34;</span>,
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;email&#34;</span>: <span style=color:#e6db74>&#34;2825873215@qq.com&#34;</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p><strong>Protobuf</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>Person</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>string</span> name <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>int32</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>string</span> email <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>该信息存储于后缀为 <code>proto</code> 的文件中，它只提供格式，而不存储数据。在使用时，用 Protobuf 编译工具将该文件编译成你所使用的语言。</p><p>例如，在 Go 语言中，会根据该信息生成编译后的 Go 文件，<code>message Person</code> 会对应到 <code>struct Person</code> 上，并提供了序列化结构体的方法。</p><p>本篇不会详细讲解 Protobuf 定义语法，只会把用到的进行简单描述，详细的前往：</p><p><a href=https://developers.google.com/protocol-buffers/docs/proto3>https://developers.google.com/protocol-buffers/docs/proto3</a></p><h2 id=编译工具>编译工具<a hidden class=anchor aria-hidden=true href=#编译工具>#</a></h2><p>将 Proto 文件编译成 Go 代码需要两个工具：</p><ul><li>protoc 工具，c++ 语言实现。</li><li>protoc-gen-go 插件，go 语言实现，给 protoc 工具提供插件，生成 go 代码。</li></ul><p>gRPC 系统也要基于 Proto 文件生成相关代码，因此还需要一个工具：</p><ul><li>protoc-gen-go-grpc 插件，go 语言实现，配合上面两个工具。</li></ul><p>下来开始安装这些工具。</p><h2 id=protoc-工具安装>protoc 工具安装<a hidden class=anchor aria-hidden=true href=#protoc-工具安装>#</a></h2><h3 id=1-下载>1. 下载<a hidden class=anchor aria-hidden=true href=#1-下载>#</a></h3><p>地址：<a href=https://github.com/protocolbuffers/protobuf/releases>https://github.com/protocolbuffers/protobuf/releases</a>。</p><p>根据自己的系统选择对应的版本，我这块选择了 Win64。</p><p><img loading=lazy src=/images/20231208111222.png alt=20231208111222.png></p><h3 id=2-环境变量>2. 环境变量<a hidden class=anchor aria-hidden=true href=#2-环境变量>#</a></h3><p>先解压，将整个目录放置到你想要的位置，再把 bin 目录加入环境变量，完成后在控制台输入命令。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ protoc --version
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>libprotoc 3.15.8
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p>成功搞定！</p><h2 id=插件安装>插件安装<a hidden class=anchor aria-hidden=true href=#插件安装>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span>go install google.golang.org<span style=color:#f92672>/</span>protobuf<span style=color:#f92672>/</span>cmd<span style=color:#f92672>/</span>protoc<span style=color:#f92672>-</span>gen<span style=color:#f92672>-</span>go<span style=color:#960050;background-color:#1e0010>@</span>v1.26<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>go install google.golang.org<span style=color:#f92672>/</span>grpc<span style=color:#f92672>/</span>cmd<span style=color:#f92672>/</span>protoc<span style=color:#f92672>-</span>gen<span style=color:#f92672>-</span>go<span style=color:#f92672>-</span>grpc<span style=color:#960050;background-color:#1e0010>@</span>v1.1<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>安装完成后，会在 $GOPATH/bin 目录下生成两个文件，记得这个目录也要加入环境变量。</p><h2 id=编写-proto>编写 Proto<a hidden class=anchor aria-hidden=true href=#编写-proto>#</a></h2><p>创建 "helloword.proto" 文件。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span>syntax <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;proto3&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>option</span> go_package <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github.com/miaogaolin/gofirst/example/helloworld&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>// The greeting service definition.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>service</span> Greeter {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#75715e>// Sends a greeting
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>rpc</span> SayHello (HelloRequest) <span style=color:#66d9ef>returns</span> (HelloReply) {}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>// The request message containing the user&#39;s name.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>HelloRequest</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>string</span> name <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>// The response message containing the greetings
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>HelloReply</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>string</span> <span style=color:#66d9ef>message</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>解释如下：</p><ul><li>第一行，proto3 声明版本号为 3，不写时，默认版本为 2。</li><li>go_package 定义包路径。</li><li>Greeter 为 rpc 服务，远程调用的方法为 SayHello。</li><li>HelloRequest 用于 SayHello 方法参数。</li><li>HelloReply 用于 SayHello 方法返回。</li><li>name 和 message 后的数字 1 是给字段分配的唯一编号，如果新增加字段就给分配 2、3、4 等等。</li></ul><h2 id=生成代码>生成代码<a hidden class=anchor aria-hidden=true href=#生成代码>#</a></h2><p>工具装好、proto 文件编写好，下来就开始使用工具生成代码。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>protoc --go_out<span style=color:#f92672>=</span>. --go_opt<span style=color:#f92672>=</span>paths<span style=color:#f92672>=</span>source_relative <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  
</span></span><span style=display:flex><span>    --go-grpc_out<span style=color:#f92672>=</span>. --go-grpc_opt<span style=color:#f92672>=</span>paths<span style=color:#f92672>=</span>source_relative <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  
</span></span><span style=display:flex><span>    helloworld.proto
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><ul><li>go_out：生成 go 文件（不含 rpc 代码）的输出目录。</li><li>go_opt=paths=source_relative：生成的 go 文件和 proto 源文件在同一目录，如果 go_out 定义为其它目录，该设置无效。</li><li>go-grpc_out：rpc 的 go 文件输出目录。</li><li>go-grpc_opt=paths=source_relative：生成 rpc 的 go 文件和 proto 源文件在同一目录，如果 go-grpc_out 定义为其它目录，该设置无效。</li></ul><p>运行后，会在当前目录下产生两个文件：</p><ul><li>helloworld.pb.go：数据类型代码。</li><li>helloworld_grpc.pb.go：rpc 相关代码，其中会产生 <code>GreeterClient</code> 和 <code>GreeterServer</code> 两个接口，一会要实现。</li></ul><h2 id=远程调用>远程调用<a hidden class=anchor aria-hidden=true href=#远程调用>#</a></h2><p>要实现 gRPC 的远程调用，就要分别实现 “客户端” 和 “服务端” 代码，下来我会给出关键性代码的说明，完整的前往 Github。</p><h3 id=1-服务端>1. 服务端<a hidden class=anchor aria-hidden=true href=#1-服务端>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// example/hellworld/server/main.go
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e>// 实现服务端 GreeterServer 接口
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>server</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 必须嵌套
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 包含了 GreeterServer 接口其它方法实现
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>UnimplementedGreeterServer</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e>// 远程调用方法的具体逻辑
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>server</span>) <span style=color:#a6e22e>SayHello</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>in</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>HelloRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>HelloReply</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	 <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Received: %v&#34;</span>, <span style=color:#a6e22e>in</span>.<span style=color:#a6e22e>GetName</span>())
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	 <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>HelloReply</span>{<span style=color:#a6e22e>Message</span>: <span style=color:#e6db74>&#34;Hello &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>in</span>.<span style=color:#a6e22e>GetName</span>()}, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 监听端口，用于接受客户端的请求
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>lis</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>Listen</span>(<span style=color:#e6db74>&#34;tcp&#34;</span>, <span style=color:#a6e22e>port</span>)
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 服务端实例化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>NewServer</span>()
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 将具体的实现注册到服务端
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>RegisterGreeterServer</span>(<span style=color:#a6e22e>s</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>server</span>{})
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 阻塞等待
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Serve</span>(<span style=color:#a6e22e>lis</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;failed to serve: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p>主线流程：</p><ol><li>监听端口；</li><li>实例化服务端；</li><li>将具体实现进行注册；</li><li>阻塞等待。</li></ol><h3 id=2-客户端>2. 客户端<a hidden class=anchor aria-hidden=true href=#2-客户端>#</a></h3><p>实现好了服务端，下来客户端只需要远程调用就行。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// example/hellworld/client/main.go
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 连接服务端
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>   <span style=color:#75715e>// grpc.WithInsecure() 跳过安全验证，即明文传输
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>   <span style=color:#75715e>// grpc.WithBlock() 等待与服务端握手成功
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>conn</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>Dial</span>(<span style=color:#a6e22e>address</span>, <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>WithInsecure</span>(), <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>WithBlock</span>())
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	 <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 客户端实例化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>NewGreeterClient</span>(<span style=color:#a6e22e>conn</span>)
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	 <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 连接超时设置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithTimeout</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cancel</span>()
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 远程调用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>SayHello</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>HelloRequest</span>{<span style=color:#a6e22e>Name</span>: <span style=color:#a6e22e>name</span>})
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;could not greet: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	 <span style=color:#75715e>// 返回消息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Greeting: %s&#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>GetMessage</span>())
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p>主线流程：</p><ol><li>连接服务端；</li><li>实例化客户端；</li><li>开始调用；</li><li>获取返回消息。</li></ol><h3 id=3-运行>3. 运行<a hidden class=anchor aria-hidden=true href=#3-运行>#</a></h3><p>先执行服务端代码，再执行客户端代码。</p><p><strong>服务端</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ go run main.go
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>2021/11/04 11:28:19 server listening at <span style=color:#f92672>[</span>::<span style=color:#f92672>]</span>:50051
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p><strong>客户端</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ go run main.go
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>2021/11/04 11:30:17 Greeting: Hello world
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p>客户端接收到了服务端的响应，一切完成！</p><h2 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h2><ul><li>gPRC 官网：<a href=https://grpc.io/docs/languages/go/quickstart/>https://grpc.io/docs/languages/go/quickstart/</a></li><li>gRPC 应用：<a href=https://segmentfault.com/a/1190000019608421>https://segmentfault.com/a/1190000019608421</a></li><li>gRPC 超时限制：<a href=https://www.cnblogs.com/jiujuan/p/13499915.html>https://www.cnblogs.com/jiujuan/p/13499915.html</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://www.gby.ai/zigzag/><span class=title>« 上一页</span><br><span>深入微服务：2. 研究 Protobuf 时发现一个挺好的算法 — ZigZag</span></a>
<a class=next href=https://www.gby.ai/go-webhook/><span class=title>下一页 »</span><br><span>我用 Go 语言解决 Github Webhook</span></a></nav><div class=comment-head>评论 & Email：</div><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 深入微服务：1. 开篇 gRPC 环境&启动 on x" href="https://x.com/intent/tweet/?text=@laomiao_ %e6%b7%b1%e5%85%a5%e5%be%ae%e6%9c%8d%e5%8a%a1%ef%bc%9a1.%20%e5%bc%80%e7%af%87%20gRPC%20%e7%8e%af%e5%a2%83%26%e5%90%af%e5%8a%a8&amp;url=https%3a%2f%2fwww.gby.ai%2fgrpc-start%2f&amp;hashtags="><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 50 50" fill="currentcolor"><path d="M5.9199219 6 20.582031 27.375 6.2304688 44H9.4101562L21.986328 29.421875 31.986328 44H44L28.681641 21.669922 42.199219 6H39.029297L27.275391 19.617188 17.933594 6H5.9199219zm3.796875 2H16.880859L40.203125 42H33.039062L9.7167969 8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 深入微服务：1. 开篇 gRPC 环境&启动 on email" href="mailto:mglluoye@gmail.com?subject=%e6%b7%b1%e5%85%a5%e5%be%ae%e6%9c%8d%e5%8a%a1%ef%bc%9a1.%20%e5%bc%80%e7%af%87%20gRPC%20%e7%8e%af%e5%a2%83%26%e5%90%af%e5%8a%a8"><svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 12C2 7.28595 2 4.92893 3.46447 3.46447 4.92893 2 7.28595 2 12 2c4.714.0 7.0711.0 8.5355 1.46447C22 4.92893 22 7.28595 22 12c0 4.714.0 7.0711-1.4645 8.5355C19.0711 22 16.714 22 12 22c-4.71405.0-7.07107.0-8.53553-1.4645C2 19.0711 2 16.714 2 12z" stroke="currentcolor" stroke-width="1.5"/><path d="M2 13H5.16026c.90517.0 1.35776.0 1.75558.183.39783.1829.69237.5266 1.28145 1.2138L8.80271 15.1032C9.39179 15.7904 9.68633 16.1341 10.0842 16.317 10.482 16.5 10.9346 16.5 11.8397 16.5H12.1603C13.0654 16.5 13.518 16.5 13.9158 16.317 14.3137 16.1341 14.6082 15.7904 15.1973 15.1032L15.8027 14.3968C16.3918 13.7096 16.6863 13.3659 17.0842 13.183 17.482 13 17.9346 13 18.8397 13H22" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/><path d="M8 7h8" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/><path d="M10 10.5h4" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/></svg></a></div></footer></article></main><footer class=footer><span>Content under license <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
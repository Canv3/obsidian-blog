<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>我用 Go 语言解决 Github Webhook | PrintLove</title><meta name=keywords content="Github,Webhook"><meta name=description content="使用 webhook 工具快速完成 Github 钩子的配置"><meta name=author content="Evan Miao"><link rel=canonical href=https://www.gby.ai/go-webhook/><link crossorigin=anonymous href=/assets/css/stylesheet.0f4d06feb7a00553d7b46603ca44aaca1dd036cd7082d6cecf39137242c0cb9e.css integrity="sha256-D00G/regBVPXtGYDykSqyh3QNs1wgtbOzzkTckLAy54=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.gby.ai/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.gby.ai/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.gby.ai/favicon-32x32.png><link rel=apple-touch-icon href=https://www.gby.ai/apple-touch-icon.png><link rel=mask-icon href=https://www.gby.ai/safari_pinned_tab.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/style.css media=print onload='this.media="all"'><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?4bddc7ae6f2203e19017f349bdcc79c2",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-VE0D4BXTS2"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VE0D4BXTS2",{anonymize_ip:!1})}</script><meta property="og:title" content="我用 Go 语言解决 Github Webhook"><meta property="og:description" content="使用 webhook 工具快速完成 Github 钩子的配置"><meta property="og:type" content="article"><meta property="og:url" content="https://www.gby.ai/go-webhook/"><meta property="og:image" content="https://plus.unsplash.com/premium_photo-1676511249826-2adf52caabee?q=80&w=500&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-01T17:51:00+08:00"><meta property="article:modified_time" content="2021-11-01T17:51:00+08:00"><meta property="og:site_name" content="PrintLove"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://plus.unsplash.com/premium_photo-1676511249826-2adf52caabee?q=80&w=500&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"><meta name=twitter:title content="我用 Go 语言解决 Github Webhook"><meta name=twitter:description content="使用 webhook 工具快速完成 Github 钩子的配置"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.gby.ai/posts/"},{"@type":"ListItem","position":2,"name":"我用 Go 语言解决 Github Webhook","item":"https://www.gby.ai/go-webhook/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"我用 Go 语言解决 Github Webhook","name":"我用 Go 语言解决 Github Webhook","description":"使用 webhook 工具快速完成 Github 钩子的配置","keywords":["Github","Webhook"],"articleBody":"Github Webhook(钩子) 说简单点，就是当你的项目触发了某个动作时，例如 git push 时，可以通知给一个线上可访问的地址。\n这块我接收通知用来自动更新我服务器上的网站，不用再自己登录服务器更新。\n首先要安装 Go 环境，查看 《环境搭建》。\n添加 webhook 打开自己的 github 项目，然后按照如图所示，打开 Settings \u003e Webhooks。\n打开后配置三项数据：\nPayload URL：自己服务的 API 接口地址，用来接受 github 的通知。 Content type：选择 application/json，表示使用 json 数据通知。 Secret：密钥，用来防止 API 接口地址被他人访问。 安装 因为要在自己服务器上写一个 API 接口，并且要处理密钥，所以我自己写了一个工具，根据配置文件就可以自定义启动服务。\n先安装。\ngo get github.com/miaogaolin/webhook 配置 在自己的项目下创建一个配置文件 hooks.json。\n{ \"bind\": \":9000\", \"items\": [ { \"repo\": \"https://github.com/miaogaolin/printlove\", \"branch\": \"main\", \"script\": \"deploy.sh\", \"secret\": \"123\" } ] } bind：端口号 repo：接受的 github 地址。 branch：接受的分支。 script：需要执行的脚本，这个一会咱自己写。 secret：上面截图中填写的密钥。 下来在自己项目下写一个 deploy.sh 脚本，用来自动更新网站的代码，这块你根据自己的实际情况写。\n#!/bin/bash git pull hugo -D 因为我的网站是用 hugo 工具生成的，所以才有了 hugo -D 命令。\n启动 一切准备好后，就可以启动 webhook 工具。\nwebhook hooks.json 如果选择后台跑，使用下面命令。\nnohup webhook hooks.json \u0026 运行该命令会在当前目录下自动生成 nohup.out 文件，该文件存储 webhook 工具的日志。\n配置 Nginx 如果你不想在使用 \"IP+ 端口 \" 形式来接受 Github 通知时，那配置个 Nginx 转发。\nserver { server_name .printlove.cn ... location /hook { rewrite ^/hook / break; proxy_pass http://127.0.0.1:9000; } } 该配置文件用来将 https://www.printlove.cn/hook 的请求转发到 9000 端口上。\n配置好后，重启。\nnginx -s reload 验证成功 所有的都配置完成后，就可以给自己的项目中 git push ，再查看 webhook 工具的运行日志，成功会出现如下日志：\nRun ./deploy.sh output: Updating 58ffcfd..81918f1 一切完成。\n","wordCount":"148","inLanguage":"zh","image":"https://plus.unsplash.com/premium_photo-1676511249826-2adf52caabee?q=80\u0026w=500\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D","datePublished":"2021-11-01T17:51:00+08:00","dateModified":"2021-11-01T17:51:00+08:00","author":[{"@type":"Person","name":"Evan Miao"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.gby.ai/go-webhook/"},"publisher":{"@type":"Organization","name":"PrintLove","logo":{"@type":"ImageObject","url":"https://www.gby.ai/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.gby.ai/ accesskey=h title="PrintLove (Alt + H)">PrintLove</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.gby.ai/archives title=文章><span>文章</span></a></li><li><a href=https://www.gby.ai/series title=系列><span>系列</span></a></li><li><a href=https://www.gby.ai/sponsor title=赞助><span>赞助</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>我用 Go 语言解决 Github Webhook</h1><div class=post-meta><span title='2021-11-01 17:51:00 +0800 CST'>2021-11-01</span>&nbsp;·&nbsp;Evan Miao&nbsp;|&nbsp;<a href=https://github.com/miaogaolin/workspace-obisidian-publisher/tree/main/content/posts/%e6%88%91%e7%94%a8%20Go%20%e8%af%ad%e8%a8%80%e8%a7%a3%e5%86%b3%20Github%20Webhook.md rel="noopener noreferrer" target=_blank>指出问题</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#添加-webhook>添加 webhook</a></li><li><a href=#安装>安装</a></li><li><a href=#配置>配置</a></li><li><a href=#启动>启动</a></li><li><a href=#配置-nginx>配置 Nginx</a></li><li><a href=#验证成功>验证成功</a></li></ul></nav></div></details></div><div class=post-content><p>Github Webhook(钩子) 说简单点，就是当你的项目触发了某个动作时，例如 <code>git push</code> 时，可以通知给一个线上可访问的地址。</p><p>这块我接收通知用来自动更新我服务器上的网站，不用再自己登录服务器更新。</p><p>首先要安装 Go 环境，查看 <a href=/golang-install/>《环境搭建》</a>。</p><h2 id=添加-webhook>添加 webhook<a hidden class=anchor aria-hidden=true href=#添加-webhook>#</a></h2><p>打开自己的 github 项目，然后按照如图所示，打开 Settings > Webhooks。</p><p><img loading=lazy src=/images/20231208111274.webp alt=20231208111274.webp></p><p>打开后配置三项数据：</p><ol><li>Payload URL：自己服务的 API 接口地址，用来接受 github 的通知。</li><li>Content type：选择 application/json，表示使用 json 数据通知。</li><li>Secret：密钥，用来防止 API 接口地址被他人访问。</li></ol><h2 id=安装>安装<a hidden class=anchor aria-hidden=true href=#安装>#</a></h2><p>因为要在自己服务器上写一个 API 接口，并且要处理密钥，所以我自己写了一个工具，根据配置文件就可以自定义启动服务。</p><p>先安装。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go get github.com/miaogaolin/webhook
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><h2 id=配置>配置<a hidden class=anchor aria-hidden=true href=#配置>#</a></h2><p>在自己的项目下创建一个配置文件 hooks.json。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;bind&#34;</span>: <span style=color:#e6db74>&#34;:9000&#34;</span>,
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;items&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;repo&#34;</span>: <span style=color:#e6db74>&#34;https://github.com/miaogaolin/printlove&#34;</span>,
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;branch&#34;</span>: <span style=color:#e6db74>&#34;main&#34;</span>,
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;script&#34;</span>: <span style=color:#e6db74>&#34;deploy.sh&#34;</span>,
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;secret&#34;</span>: <span style=color:#e6db74>&#34;123&#34;</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><ul><li>bind：端口号</li><li>repo：接受的 github 地址。</li><li>branch：接受的分支。</li><li>script：需要执行的脚本，这个一会咱自己写。</li><li>secret：上面截图中填写的密钥。</li></ul><p>下来在自己项目下写一个 deploy.sh 脚本，用来自动更新网站的代码，这块你根据自己的实际情况写。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>git pull
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>hugo -D
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p>因为我的网站是用 hugo 工具生成的，所以才有了 <code>hugo -D</code> 命令。</p><h2 id=启动>启动<a hidden class=anchor aria-hidden=true href=#启动>#</a></h2><p>一切准备好后，就可以启动 webhook 工具。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>webhook hooks.json
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p>如果选择后台跑，使用下面命令。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nohup webhook hooks.json &amp;
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p>运行该命令会在当前目录下自动生成 nohup.out 文件，该文件存储 webhook 工具的日志。</p><h2 id=配置-nginx>配置 Nginx<a hidden class=anchor aria-hidden=true href=#配置-nginx>#</a></h2><p>如果你不想在使用 "IP+ 端口 " 形式来接受 Github 通知时，那配置个 Nginx 转发。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>		
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>		server_name .printlove.cn
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>		...
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    location /hook <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        rewrite ^/hook / break;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        proxy_pass http://127.0.0.1:9000;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p>该配置文件用来将 <a href=https://www.printlove.cn/hook>https://www.printlove.cn/hook</a> 的请求转发到 9000 端口上。</p><p>配置好后，重启。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nginx -s reload
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><h2 id=验证成功>验证成功<a hidden class=anchor aria-hidden=true href=#验证成功>#</a></h2><p>所有的都配置完成后，就可以给自己的项目中 <code>git push</code> ，再查看 webhook 工具的运行日志，成功会出现如下日志：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Run ./deploy.sh output: Updating 58ffcfd..81918f1
</span></span><span style=display:flex><span>  
</span></span></code></pre></div><p>一切完成。</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://www.gby.ai/grpc-start/><span class=title>« 上一页</span><br><span>深入微服务：1. 开篇 gRPC 环境&启动</span></a>
<a class=next href=https://www.gby.ai/go-bestpractices/><span class=title>下一页 »</span><br><span>Google：12 条 Golang 最佳实践</span></a></nav><div class=comment-head>评论 & Email：</div><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 我用 Go 语言解决 Github Webhook on x" href="https://x.com/intent/tweet/?text=@laomiao_ %e6%88%91%e7%94%a8%20Go%20%e8%af%ad%e8%a8%80%e8%a7%a3%e5%86%b3%20Github%20Webhook&amp;url=https%3a%2f%2fwww.gby.ai%2fgo-webhook%2f&amp;hashtags="><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 50 50" fill="currentcolor"><path d="M5.9199219 6 20.582031 27.375 6.2304688 44H9.4101562L21.986328 29.421875 31.986328 44H44L28.681641 21.669922 42.199219 6H39.029297L27.275391 19.617188 17.933594 6H5.9199219zm3.796875 2H16.880859L40.203125 42H33.039062L9.7167969 8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 我用 Go 语言解决 Github Webhook on email" href="mailto:mglluoye@gmail.com?subject=%e6%88%91%e7%94%a8%20Go%20%e8%af%ad%e8%a8%80%e8%a7%a3%e5%86%b3%20Github%20Webhook"><svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 12C2 7.28595 2 4.92893 3.46447 3.46447 4.92893 2 7.28595 2 12 2c4.714.0 7.0711.0 8.5355 1.46447C22 4.92893 22 7.28595 22 12c0 4.714.0 7.0711-1.4645 8.5355C19.0711 22 16.714 22 12 22c-4.71405.0-7.07107.0-8.53553-1.4645C2 19.0711 2 16.714 2 12z" stroke="currentcolor" stroke-width="1.5"/><path d="M2 13H5.16026c.90517.0 1.35776.0 1.75558.183.39783.1829.69237.5266 1.28145 1.2138L8.80271 15.1032C9.39179 15.7904 9.68633 16.1341 10.0842 16.317 10.482 16.5 10.9346 16.5 11.8397 16.5H12.1603C13.0654 16.5 13.518 16.5 13.9158 16.317 14.3137 16.1341 14.6082 15.7904 15.1973 15.1032L15.8027 14.3968C16.3918 13.7096 16.6863 13.3659 17.0842 13.183 17.482 13 17.9346 13 18.8397 13H22" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/><path d="M8 7h8" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/><path d="M10 10.5h4" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/></svg></a></div></footer></article></main><footer class=footer><span>Content under license <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>